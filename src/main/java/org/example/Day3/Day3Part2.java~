package org.example.Day3;

import org.example.Day1.Day1;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.*;
import java.util.logging.Logger;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Day3Part2 {
    private static final Logger logger = Logger.getLogger(Day3.class.getName());

    public static String readFile(String filePath) throws IOException {
        StringBuilder contentBuilder = new StringBuilder();
        try (BufferedReader br = new BufferedReader(new FileReader(filePath))) {
            String line;
            while ((line = br.readLine()) != null) {
                contentBuilder.append(line).append("\n");
            }
        }
        return contentBuilder.toString();
    }

    public static Map<String, List<List<Integer>>> extractFunctions(String text) {
        Map<String, List<List<Integer>>> functionMap = new HashMap<>();

        String regex = "(mul\\((\\d+),(\\d+)\\))|(do\\(\\))|(don't\\(\\))";
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(text);

        while (matcher.find()) {
            String functionName = matcher.group(1);
            logger.info("Found: " + functionName + "(" + functionName);

            if (Objects.equals(functionName, "mul")) {
                functionMap.computeIfAbsent(functionName, k -> new ArrayList<>())
                        .add(List.of(Integer.valueOf(functionName)));
            }

        }

        return functionMap;
    }

    public static int sumList(List<Integer> list) {
        return list.stream().mapToInt(Integer::intValue).sum();
    }

    private static void calculateAndLogTotal(Map<String, List<List<Integer>>> functionMap) {
        List<Integer> listOfSums = calculateSums(functionMap);
        int totalSum = sumList(listOfSums);
        logger.info("Total sum: " + totalSum);
    }

    private static List<Integer> calculateSums(Map<String, List<List<Integer>>> functionMap) {
        List<Integer> listOfSums = new ArrayList<>();
        for (Map.Entry<String, List<List<Integer>>> entry : functionMap.entrySet()) {
            List<List<Integer>> paramsList = entry.getValue();
            for (List<Integer> params : paramsList) {
                int result = params.get(0) * params.get(1);
                listOfSums.add(result);
            }
            System.out.println(entry.getKey() + " -> " + paramsList);
        }
        return listOfSums;
    }

    public static void main(String[] args) throws IOException {
        String filePath = "src/main/java/org/example/Day3/input.txt";
        String fileContent = readFile(filePath);
        Map<String, List<List<Integer>>> functionMap = extractFunctions(fileContent);
        calculateAndLogTotal(functionMap);
    }
}
